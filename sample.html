<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Designer Sample Creation Form</title>
<link rel="icon" href="data:,">
<style>
body {font-family: Arial, sans-serif;background:#f8f9fa;margin:0;padding:0;}
.container {width:90%;max-width:1100px;margin:40px auto;background:#fff;padding:30px;border-radius:12px;
  box-shadow:0 0 10px rgba(0,0,0,0.1);}
h1{text-align:center;color:#007bff;margin-bottom:25px;}
label{display:block;margin-top:10px;font-weight:bold;}
input,select,textarea{width:100%;padding:8px;margin-top:4px;border:1px solid #ccc;border-radius:6px;font-size:14px;}
textarea{resize:vertical;}
.row{display:flex;gap:10px;margin-bottom:8px;}
button{background:#007bff;color:#fff;border:none;padding:10px 18px;border-radius:6px;cursor:pointer;font-size:16px;margin-top:15px;}
button:disabled{background:#ccc;cursor:not-allowed;}
#msg{margin-top:15px;font-weight:bold;text-align:center;}
h3{background:#007bff;color:#fff;padding:6px 10px;border-radius:4px;margin-top:20px;font-size:16px;}
</style>
</head>
<body>
<div class="container">
<h1>Designer Sample Creation Form</h1>

<form id="entryForm"
      action="https://script.google.com/macros/s/AKfycbwpbCvnRpjaMIQi-SCWMNcIMgJXDqrCr3Y5K4uZ-OZpQ35GuBmoejLeC1MY5TvR0rMK/exec"
      method="POST"
      enctype="multipart/form-data"
      target="uploadFrame"
      novalidate>

<div class="row">
  <div style="flex:1">
    <label>Designer Name*</label>
    <select id="designerName" name="designerName" required></select>
  </div>
  <div style="flex:1">
    <label>Unit*</label>
    <select id="unit" name="unit" required></select>
  </div>
</div>

<div class="row">
  <div style="flex:1">
    <label>Product Name*</label>
    <select id="productName" name="productName" required></select>
  </div>
  <div style="flex:1">
    <label>Print Style ID*</label>
    <select id="printStyleId" name="printStyleId" required></select>
  </div>
</div>

<div class="row">
  <div style="flex:1">
    <label>Print Style No*</label>
    <select id="printStyleNo" name="printStyleNo" required></select>
  </div>
  <div style="flex:1">
    <label>Design No*</label>
    <input type="text" id="designNo" name="designNo" required>
  </div>
</div>

<div class="row">
  <div style="flex:1">
    <label>Color*</label>
    <input type="text" id="color" name="color" required>
  </div>
  <div style="flex:1">
    <label>Top Length*</label>
    <input type="text" id="topLength" name="topLength">
  </div>
</div>

<div class="row">
  <div style="flex:1">
    <label>Bottom Length*</label>
    <input type="text" id="bottomLength" name="bottomLength">
  </div>
  <div style="flex:1">
    <label>Details</label>
    <textarea id="details" name="details"></textarea>
  </div>
</div>

<div class="row">
  <div style="flex:1">
    <label>Product Image (Front)*</label>
    <input type="file" id="productImage" name="productImage" accept="image/*">
  </div>
  <div style="flex:1">
    <label>Product Image (Back)</label>
    <input type="file" id="productImageBack" name="productImageBack" accept="image/*">
  </div>
</div>

<h3>Materials</h3>
<div id="materials"></div>

<h3>Attachments</h3>
<div id="attachments"></div>

<p id="msg"></p>
<button id="submitBtn" type="submit">Save</button>
</form>
</div>

<iframe name="uploadFrame" style="display:none"></iframe>

<script>
/* ---------- CONFIG ---------- */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwpbCvnRpjaMIQi-SCWMNcIMgJXDqrCr3Y5K4uZ-OZpQ35GuBmoejLeC1MY5TvR0rMK/exec"; // your /exec URL


/* ---------- BUILD UI SECTIONS ---------- */
function buildDynamicRows() {
  console.log("üîß Building dynamic rows...");
  const matDiv = document.getElementById("materials");
  const attDiv = document.getElementById("attachments");

  if (matDiv) {
    matDiv.innerHTML = "";
    for (let i = 1; i <= 5; i++) {
      const row = document.createElement("div");
      row.className = "row";
      row.innerHTML = `
        <input type="text" id="matName${i}" name="matName${i}" placeholder="Material ${i} Name">
        <input type="text" id="matQty${i}" name="matQty${i}" placeholder="Qty">`;
      matDiv.appendChild(row);
    }
  }

  if (attDiv) {
    attDiv.innerHTML = "";
    for (let i = 1; i <= 5; i++) {
      const row = document.createElement("div");
      row.className = "row";
      row.innerHTML = `
        <input type="text" id="attName${i}" name="attName${i}" placeholder="Attachment ${i} Name">
        <input type="file" id="attPhoto${i}" name="attPhoto${i}" accept="image/*">`;
      attDiv.appendChild(row);
    }
  }
}


/* ---------- POPULATE DROPDOWNS ---------- */
function populateDropdowns(data) {
  console.log("‚úÖ Populating dropdowns:", data);
  const map = {
    designerName: data?.designers || [],
    unit: data?.units || [],
    productName: data?.products || [],
    printStyleId: data?.printStyleIDs || [],
    printStyleNo: data?.printStyleNos || []
  };
  for (const [id, arr] of Object.entries(map)) {
    const el = document.getElementById(id);
    if (!el) continue;
    el.innerHTML =
      "<option value=''>Select</option>" +
      arr.map(v => `<option>${String(v)}</option>`).join("");
  }
}


/* ---------- LOAD DROPDOWNS VIA JSONP ---------- */
function loadDropdownsJSONP() {
  const msg = document.getElementById("msg");
  if (msg) msg.textContent = "Loading dropdowns...";
  const cb = "cbDropdown_" + Date.now();
  window[cb] = function (data) {
    populateDropdowns(data);
    if (msg) msg.textContent = "";
    delete window[cb];
    const s = document.getElementById(cb);
    if (s) s.remove();
  };
  const s = document.createElement("script");
  s.id = cb;
  s.src = `${SCRIPT_URL}?action=getDropdownValues&callback=${cb}`;
  s.onerror = function () {
    if (msg) msg.textContent = "‚ùå Failed to load dropdowns";
    console.error("Dropdown JSONP failed");
  };
  document.body.appendChild(s);
}


/* ---------- INIT ---------- */
document.addEventListener("DOMContentLoaded", () => {
  console.log("üåê Loaded page, SCRIPT_URL =", SCRIPT_URL);
  buildDynamicRows();        // always build visible UI
  loadDropdownsJSONP();      // then fetch dropdown data

  const form = document.getElementById("entryForm");
  const btn = document.getElementById("submitBtn");
  const msg = document.getElementById("msg");

  // Don‚Äôt block submit (no preventDefault)
  form.addEventListener("submit", () => {
    if (btn) btn.disabled = true;
    if (msg) msg.textContent = "Saving...";
  });

  window.addEventListener("message", (ev) => {
    try {
      const res = JSON.parse(ev.data || "{}");
      console.log("üßæ Response from iframe:", res);
      if (res.success) {
        msg.textContent = "‚úÖ Saved successfully!";
        form.reset();
        buildDynamicRows(); // rebuild cleared fields
      } else {
        msg.textContent = "‚ùå " + (res.error || "Failed to save");
      }
    } catch (err) {
      console.warn("Non-JSON message:", ev.data);
    }
    if (btn) btn.disabled = false;
  });
});
</script>

</body>
</html>
      
