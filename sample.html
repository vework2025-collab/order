<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Vasansi Enterprise Application — Sample Form</title>
<link rel="stylesheet" href="assets/style.css">
<link rel="icon" href="data:,">
<style>
  body { font-family: Segoe UI, sans-serif; background:#f7f7f7; }
  .card { max-width:900px; margin:20px auto; background:#fff; padding:20px 30px; border-radius:10px; box-shadow:0 1px 4px rgba(0,0,0,0.1); }
  label { display:block; margin-top:10px; font-weight:600; }
  input, select, textarea { width:100%; padding:8px; border:1px solid #ccc; border-radius:6px; margin-top:4px; }
  button { background:#007bff; color:#fff; border:none; border-radius:6px; padding:10px 16px; margin-top:15px; cursor:pointer; }
  button:hover { background:#0069d9; }
</style>
</head>
<body>
<div class="card">
  <h2>Designer Sample Creation Form</h2>

  <form id="sampleForm">
    <label>Designer Name</label>
    <select id="designerName" required></select>

    <label>Unit</label>
    <select id="unit" required></select>

    <label>Product Name</label>
    <select id="productName" required></select>

    <label>Print Style ID</label>
    <select id="printStyleId"></select>

    <label>Print Style No</label>
    <select id="printStyleNo"></select>

    <label>Design No</label>
    <input type="text" id="designNo" required>

    <label>Color</label>
    <input type="text" id="color">

    <label>Top Length</label>
    <input type="text" id="topLength">

    <label>Bottom Length</label>
    <input type="text" id="bottomLength">

    <label>Details</label>
    <textarea id="details" rows="3"></textarea>

    <label>Product Image</label>
    <input type="file" id="productImage" accept="image/*">

    <button type="button" onclick="submitSample()">Save Sample</button>
  </form>

  <p id="msg" style="margin-top:10px; font-weight:600;"></p>
</div>

<script>
// ====== Fetch Dropdowns ======
window.onload = function() {
  google.script.run.withSuccessHandler(populateDropdowns).getDropdownValues();
};

function populateDropdowns(data) {
  const map = {
    designerName: data.designers,
    unit: data.units,
    productName: data.products,
    printStyleId: data.printStyleIDs,
    printStyleNo: data.printStyleNos
  };
  Object.keys(map).forEach(id => {
    const select = document.getElementById(id);
    select.innerHTML = "<option value=''>Select</option>" + map[id].map(v=>`<option>${v}</option>`).join("");
  });
}

// ====== Convert image to Base64 ======
function getBase64(file) {
  return new Promise((resolve,reject)=>{
    const reader = new FileReader();
    reader.onload = ()=>resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// ====== Submit Form ======
async function submitSample() {
  const msg = document.getElementById("msg");
  msg.textContent = "Uploading... Please wait.";

  // Product Image Front
const fileFront = document.getElementById("productImage").files[0];
let fileFrontData = null, fileFrontType = "", fileFrontName = "";
if (fileFront) {
  fileFrontData = await getBase64(fileFront);
  fileFrontType = fileFront.type;
  fileFrontName = fileFront.name;
}

// Product Image Back
const fileBack = document.getElementById("productImageBack").files[0];
let fileBackData = null, fileBackType = "", fileBackName = "";
if (fileBack) {
  fileBackData = await getBase64(fileBack);
  fileBackType = fileBack.type;
  fileBackName = fileBack.name;
}


  const data = {
    designerName: document.getElementById("designerName").value,
    unit: document.getElementById("unit").value,
    productName: document.getElementById("productName").value,
    printStyleId: document.getElementById("printStyleId").value,
    printStyleNo: document.getElementById("printStyleNo").value,
    designNo: document.getElementById("designNo").value,
    color: document.getElementById("color").value,
    topLength: document.getElementById("topLength").value,
    bottomLength: document.getElementById("bottomLength").value,
    details: document.getElementById("details").value,
    productImageData: fileFrontData,
productImageType: fileFrontType,
productImageName: fileFrontName,
productImageBackData: fileBackData,
productImageBackType: fileBackType,
productImageBackName: fileBackName,
    materials: [],
    attachments: []
  };

  google.script.run.withSuccessHandler(res=>{
    msg.textContent = res;
    document.getElementById("sampleForm").reset();
  }).withFailureHandler(err=>{
    msg.textContent = "❌ Error: " + err.message;
  }).submitForm(data);
}
</script>
</body>
</html>
