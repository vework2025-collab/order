  <!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        background: #f3f4f6;
        padding: 30px;
        color: #333;
      }

      .container {
        background: white;
        border-radius: 14px;
        padding: 30px 40px;
        max-width: 950px;
        margin: auto;
        box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      }

      h2 {
        text-align: center;
        margin-bottom: 25px;
        font-weight: 600;
        color: #007bff;
      }

      table { width: 100%; border-collapse: collapse; }
      td { padding: 8px 10px; vertical-align: middle; }

      label {
        font-weight: 600;
        display: block;
        margin-bottom: 4px;
        color: #444;
      }

      input, select, textarea {
        width: 100%;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        transition: border-color 0.2s;
      }

      input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: #007bff;
      }

      textarea { resize: vertical; }

      .section { margin-top: 25px; }

      h3 {
        background: #007bff;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 16px;
        margin-top: 30px;
      }

      .row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        align-items: center;
      }
      .row input[type="text"] { flex: 1 1 50%; }
      .row .file-box { flex: 1 1 50%; }
      .row .file-box input[type="file"] {
        width: 100%;
        background: #f8f9fa;
        padding: 10px;
        border-radius: 8px;
        border: 1px dashed #bbb;
        cursor: pointer;
      }
      .row .file-box input[type="file"]:hover { border-color: #007bff; }

      .file-input {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 8px;
        border: 1px dashed #bbb;
      }
      .file-input:hover { border-color: #007bff; }

      button {
        margin-top: 25px;
        width: 100%;
        background-color: #007bff;
        color: white;
        border: none;
        padding: 12px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s;
      }
      button.active { background-color: #28a745; }
      button:disabled { background: #ccc; cursor: not-allowed; }

      #msg {
        text-align: center;
        font-weight: 500;
        margin-top: 15px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <form id="entryForm">
        <h2>Designer Sample Creation Form</h2>

        <table>
          <tr>
            <td><label>Designer Name*</label></td>
            <td><select id="designerName" required></select></td>
            <td><label>Unit*</label></td>
            <td><select id="unit" required></select></td>
          </tr>
          <tr>
            <td><label>Product Name*</label></td>
            <td><select id="productName" required></select></td>
            <td><label>Print Style ID*</label></td>
            <td><select id="printStyleId" required></select></td>
          </tr>
          <tr>
            <td><label>Print Style No*</label></td>
            <td><select id="printStyleNo" required></select></td>
            <td><label>Design No*</label></td>
            <td><input type="text" id="designNo" required></td>
          </tr>
          <tr>
            <td><label>Color*</label></td>
            <td><input type="text" id="color" required></td>
            <td><label>Top Length*</label></td>
            <td><input type="number" id="topLength" placeholder="In CM" step="0.01" required></td>
          </tr>
          <tr>
            <td><label>Bottom Length*</label></td>
            <td><input type="number" id="bottomLength" placeholder="In CM" step="0.01" required></td>
            <td><label>Details</label></td>
            <td><textarea id="details" rows="2"></textarea></td>
          </tr>
          <tr>
            <td><label>Product Image (Front)*</label></td>
            <td colspan="3"><input type="file" id="productImage" accept="image/*" required class="file-input"></td>
          </tr>
          <tr>
            <td><label>Product Image (Back)</label></td>
            <td colspan="3"><input type="file" id="productImageBack" accept="image/*" class="file-input"></td>
          </tr>
        </table>

        <h3>Materials</h3>
        <div id="materials"></div>

        <h3>Attachments</h3>
        <div id="attachments"></div>

        <button id="submitBtn" type="submit" disabled>Save</button>
        <p id="msg"></p>
      </form>
    </div>

    <script>
     
<script>
/* ===== CONFIG ===== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyWq6umwvKKy23eJ3eDO6ic_J2R5Ir5jOpkNDW0AG7EEVJAyAqiJvK-r_T1VQZrAA32/exec";

/* ===== HELPERS ===== */
function toBase64(file){
  return new Promise((resolve,reject)=>{
    const r=new FileReader();
    r.onload=()=>resolve(r.result);
    r.onerror=reject;
    r.readAsDataURL(file);
  });
}

function populateDropdowns(data){
  const map = {
    designerName : data.designers || [],
    unit         : data.units || [],
    productName  : data.products || [],
    printStyleId : data.printStyleIDs || [],
    printStyleNo : data.printStyleNos || []
  };
  Object.entries(map).forEach(([id, arr])=>{
    const el = document.getElementById(id);
    if(!el) return;
    el.innerHTML = "<option value=''>Select</option>" + arr.map(v=>`<option>${String(v)}</option>`).join("");
  });
}

<script>
/* keep your SCRIPT_URL, helpers, loadDropdowns, submit handler as-is */

/* REPLACE your buildDynamicRows() with this version */
function buildDynamicRows(){
  // --- Materials ---
  const matDiv = document.getElementById("materials");
  if (matDiv){
    matDiv.innerHTML = "";
    for (let i = 1; i <= 5; i++){
      const row = document.createElement("div");
      row.className = "row";

      const inName = document.createElement("input");
      inName.type = "text";
      inName.id = "matName"+i;
      inName.placeholder = "Material " + i + " Name";

      const inQty = document.createElement("input");
      inQty.type = "text";
      inQty.id = "matQty"+i;
      inQty.placeholder = "Qty";

      row.appendChild(inName);
      row.appendChild(inQty);
      matDiv.appendChild(row);
    }
  }

  // --- Attachments ---
  const attDiv = document.getElementById("attachments");
  if (attDiv){
    attDiv.innerHTML = "";
    for (let i = 1; i <= 5; i++){
      const row = document.createElement("div");
      row.className = "row";

      const inLabel = document.createElement("input");
      inLabel.type = "text";
      inLabel.id = "attName"+i;
      inLabel.placeholder = "Attachment " + i + " Name";

      const inFile = document.createElement("input");
      inFile.type = "file";
      inFile.id = "attPhoto"+i;
      inFile.accept = "image/*";
      inFile.className = "file-input";

      row.appendChild(inLabel);
      row.appendChild(inFile);
      attDiv.appendChild(row);
    }
  }
}

/* POST to Apps Script to get dropdown values */
async function loadDropdowns(){
  const msgEl = document.getElementById("msg");
  if (msgEl) msgEl.textContent = "Loading dropdowns...";
  const res = await fetch(SCRIPT_URL, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ action:"getDropdownValues" })
  });
  const data = await res.json();
  populateDropdowns(data);
  if (msgEl) msgEl.textContent = "";
}

/* Gather materials & attachments arrays */
async function gatherMaterialsAndAttachments(){
  const materials = [];
  for (let i=1;i<=5;i++){
    materials.push({
      name: (document.getElementById("matName"+i)?.value || ""),
      qty : (document.getElementById("matQty"+i)?.value || "")
    });
  }

  const attachments = [];
  for (let i=1;i<=5;i++){
    const name = (document.getElementById("attName"+i)?.value || "");
    const fInp = document.getElementById("attPhoto"+i);
    let photoData="", photoType="", photoName="";
    if (fInp && fInp.files && fInp.files[0]){
      const f = fInp.files[0];
      photoData = await toBase64(f);
      photoType = f.type;
      photoName = f.name;
    }
    attachments.push({ name, photoData, photoType, photoName });
  }

  return { materials, attachments };
}

/* ===== MAIN WIRING ===== */
document.addEventListener("DOMContentLoaded", () => {
  // build dynamic UI sections
  buildDynamicRows();
  // load dropdowns
  loadDropdowns().catch(err=>{
    console.error("Dropdown load failed:", err);
    const msgEl = document.getElementById("msg");
    if (msgEl) msgEl.textContent = "❌ Failed to load dropdowns";
  });

  // form submit handler (POST)
  const form = document.getElementById("entryForm");
  const btn  = document.getElementById("submitBtn");
  const msg  = document.getElementById("msg");

  form.addEventListener("submit", async (e)=>{
    e.preventDefault();
    if (btn) btn.disabled = true;
    if (msg) msg.textContent = "Saving...";

    const fileFront = document.getElementById("productImage")?.files[0] || null;
    const fileBack  = document.getElementById("productImageBack")?.files[0] || null;

    const productImageData     = fileFront ? await toBase64(fileFront) : "";
    const productImageBackData = fileBack  ? await toBase64(fileBack)  : "";

    const { materials, attachments } = await gatherMaterialsAndAttachments();

    const formData = {
      designerName: document.getElementById("designerName")?.value || "",
      unit: document.getElementById("unit")?.value || "",
      productName: document.getElementById("productName")?.value || "",
      printStyleId: document.getElementById("printStyleId")?.value || "",
      printStyleNo: document.getElementById("printStyleNo")?.value || "",
      designNo: document.getElementById("designNo")?.value || "",
      color: document.getElementById("color")?.value || "",
      topLength: document.getElementById("topLength")?.value || "",
      bottomLength: document.getElementById("bottomLength")?.value || "",
      details: document.getElementById("details")?.value || "",
      productImageData,
      productImageBackData,
      productImageType: fileFront ? fileFront.type : "",
      productImageName: fileFront ? fileFront.name : "",
      productImageBackType: fileBack ? fileBack.type : "",
      productImageBackName: fileBack ? fileBack.name : "",
      materials,
      attachments
    };

    try{
      const res = await fetch(SCRIPT_URL, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ action:"submitSample", formData })
      });
      const j = await res.json();
      if (j.success){
        if (msg) msg.textContent = "✅ Saved successfully!";
        form.reset();
        // rebuild rows to clear file inputs nicely
        buildDynamicRows();
      } else {
        if (msg) msg.textContent = "❌ " + (j.error || "Failed to save");
      }
    }catch(err){
      if (msg) msg.textContent = "❌ " + err.message;
      console.error(err);
    }finally{
      if (btn) btn.disabled = false;
    }
  });
});
</script>
  </body>
</html>
