<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sample View</title>
<style>
  body {font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5;}
  h1 {color: #004aad;}
  table {border-collapse: collapse; width: 100%; background: #fff; box-shadow: 0 0 6px rgba(0,0,0,.1);}
  th, td {padding: 10px; border: 1px solid #ddd; text-align: left;}
  th {background: #004aad; color: white;}
  img.thumb {width: 60px; height: 60px; object-fit: cover; border-radius: 6px;}
  .filter-bar {margin-bottom: 15px; display: flex; gap: 10px;}
  select, input {padding: 8px; border: 1px solid #ccc; border-radius: 6px;}
</style>
</head>
<body>
<h1>Sample View</h1>

<div class="filter-bar">
  <select id="designerFilter"><option value="">All Designers</option></select>
  <select id="unitFilter"><option value="">All Units</option></select>
  <select id="productFilter"><option value="">All Products</option></select>
  <select id="styleIdFilter"><option value="">All Style IDs</option></select>
  <select id="styleNoFilter"><option value="">All Style Nos</option></select>
  <input type="text" id="searchBox" placeholder="Search Design No...">
</div>

<table id="samplesTable">
  <thead>
    <tr>
      <th>Sr No</th>
      <th>Designer Name</th>
      <th>Unit</th>
      <th>Product Name</th>
      <th>Print Style ID</th>
      <th>Print Style No</th>
      <th>Design No</th>
      <th>Product Image (Front)</th>
      <th>Product Image (Back)</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby-dpjTO3lDKPC9lHXjz4zQN3Cl7uoafvcocQDaWDmHurmxsAZrhszC3bj3rbXmdkcr/exec";

let allData = [];

async function loadSamples() {
  const res = await fetch(`${SCRIPT_URL}?action=getSamplesData`);
  const data = await res.json();
  allData = data;
  populateFilters(data);
  renderTable(data);
}

function populateFilters(data) {
  const unique = (key) => [...new Set(data.map(d => d[key]).filter(Boolean))];
  const setOptions = (id, values) => {
    const el = document.getElementById(id);
    el.innerHTML = `<option value="">All</option>` + values.map(v => `<option>${v}</option>`).join("");
  };
  setOptions("designerFilter", unique("designerName"));
  setOptions("unitFilter", unique("unit"));
  setOptions("productFilter", unique("productName"));
  setOptions("styleIdFilter", unique("printStyleId"));
  setOptions("styleNoFilter", unique("printStyleNo"));
}

function renderTable(data) {
  const tbody = document.querySelector("#samplesTable tbody");
  tbody.innerHTML = "";
  data.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.srNo}</td>
      <td>${row.designerName || ""}</td>
      <td>${row.unit || ""}</td>
      <td>${row.productName || ""}</td>
      <td>${row.printStyleId || ""}</td>
      <td>${row.printStyleNo || ""}</td>
      <td>${row.designNo || ""}</td>
      <td>${row.imageFront ? `<a href="${row.imageFront}" target="_blank"><img class="thumb" src="${row.imageFront}"></a>` : ""}</td>
      <td>${row.imageBack ? `<a href="${row.imageBack}" target="_blank"><img class="thumb" src="${row.imageBack}"></a>` : ""}</td>
    `;
    tbody.appendChild(tr);
  });
}

function applyFilters() {
  let filtered = [...allData];
  const dF = document.getElementById("designerFilter").value;
  const uF = document.getElementById("unitFilter").value;
  const pF = document.getElementById("productFilter").value;
  const idF = document.getElementById("styleIdFilter").value;
  const noF = document.getElementById("styleNoFilter").value;
  const search = document.getElementById("searchBox").value.toLowerCase();

  if (dF) filtered = filtered.filter(d => d.designerName === dF);
  if (uF) filtered = filtered.filter(d => d.unit === uF);
  if (pF) filtered = filtered.filter(d => d.productName === pF);
  if (idF) filtered = filtered.filter(d => d.printStyleId === idF);
  if (noF) filtered = filtered.filter(d => d.printStyleNo === noF);
  if (search) filtered = filtered.filter(d => (d.designNo || "").toLowerCase().includes(search));

  renderTable(filtered);
}

document.querySelectorAll(".filter-bar select, #searchBox").forEach(el => {
  el.addEventListener("change", applyFilters);
  el.addEventListener("keyup", applyFilters);
});

loadSamples();
</script>
</body>
</html>
